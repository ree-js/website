var l=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(r,t)=>(typeof require<"u"?require:r)[t]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});import A from"node:crypto";import E from"node:stream/promises";import M from"node:stream";import H from"node:http";var $=Object.create,b=Object.defineProperty,D=Object.getOwnPropertyDescriptor,T=Object.getOwnPropertyNames,k=Object.getPrototypeOf,C=Object.prototype.hasOwnProperty,ee=(e=>typeof l<"u"?l:typeof Proxy<"u"?new Proxy(e,{get:(r,t)=>(typeof l<"u"?l:r)[t]}):e)(function(e){if(typeof l<"u")return l.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')}),d=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),G=(e,r)=>{for(var t in r)b(e,t,{get:r[t],enumerable:!0})},g=(e,r,t,c)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of T(r))!C.call(e,s)&&s!==t&&b(e,s,{get:()=>r[s],enumerable:!(c=D(r,s))||c.enumerable});return e},W=(e,r,t)=>(g(e,r,"default"),t&&g(t,r,"default")),h=(e,r,t)=>(t=e!=null?$(k(e)):{},g(r||!e||!e.__esModule?b(t,"default",{value:e,enumerable:!0}):t,e)),B=d(e=>{"use strict";var r=e&&e.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(e,"__esModule",{value:!0});var t=r(A),c=global.fetch;typeof global.crypto>"u"&&(global.crypto=t.default),global.fetch=(s,a)=>(a={compress:!1,...a},c(s,a))}),_=d(e=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getRequestListener=void 0;var r=M,t=E;B();var c=s=>async(a,u)=>{let i=a.method||"GET",f=`http://${a.headers.host}${a.url}`,y=[],j=a.rawHeaders.length;for(let o=0;o<j;o+=2)y.push([a.rawHeaders[o],a.rawHeaders[o+1]]);let p={method:i,headers:y};i==="GET"||i==="HEAD"||(p.body=r.Readable.toWeb(a),p.duplex="half");let n;try{n=await s(new Request(f.toString(),p))}catch(o){n=new Response(null,{status:500}),o instanceof Error&&(o.name==="TimeoutError"||o.constructor.name==="TimeoutError")&&(n=new Response(null,{status:504}))}let P=n.headers.get("content-type")||"",R=n.headers.get("x-accel-buffering")||"",S=n.headers.get("content-encoding"),L=n.headers.get("content-length"),x=n.headers.get("transfer-encoding");for(let[o,v]of n.headers)o==="set-cookie"?u.setHeader(o,n.headers.getSetCookie(o)):u.setHeader(o,v);if(u.statusCode=n.status,n.body)try{if(S||x||L||/^no$/i.test(R)||!/^(application\/json\b|text\/(?!event-stream\b))/i.test(P))await(0,t.pipeline)(r.Readable.fromWeb(n.body),u);else{let o=await n.text();u.setHeader("Content-Length",Buffer.byteLength(o)),u.end(o)}}catch(o){console.error(o);let v=o instanceof Error?o:new Error("unknown error",{cause:o});u.destroy(v)}else u.end()};e.getRequestListener=c}),N=d(e=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.serve=e.createAdaptorServer=void 0;var r=H,t=_(),c=a=>{let u=a.fetch,i=(0,t.getRequestListener)(u);return(a.createServer||r.createServer)(a.serverOptions||{},i)};e.createAdaptorServer=c;var s=(a,u)=>{let i=(0,e.createAdaptorServer)(a);return i.listen(a?.port??3e3,a.hostname??"0.0.0.0",()=>{let f=i.address();u&&u(f)}),i};e.serve=s}),O=d(e=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getRequestListener=e.createAdaptorServer=e.serve=void 0;var r=N();Object.defineProperty(e,"serve",{enumerable:!0,get:function(){return r.serve}}),Object.defineProperty(e,"createAdaptorServer",{enumerable:!0,get:function(){return r.createAdaptorServer}});var t=_();Object.defineProperty(e,"getRequestListener",{enumerable:!0,get:function(){return t.getRequestListener}})}),q={};G(q,{__esModule:()=>z,createAdaptorServer:()=>I,default:()=>Q,getRequestListener:()=>F,serve:()=>J});var w=h(O());W(q,h(O()));var z=!0,{getRequestListener:F,createAdaptorServer:I,serve:J}=w,{default:m,...K}=w,Q=m!==void 0?m:K;export{z as __esModule,I as createAdaptorServer,Q as default,F as getRequestListener,J as serve};
//# sourceMappingURL=node-server.bundle.mjs.map