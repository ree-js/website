/* esm.sh - esbuild bundle(periscopic@3.1.0) node production */
import{walk as b}from"./a72b14.js";import m from"./4e2eca.js";function _(r){let e=new WeakMap,i=new Map,l=new c(null,!1),n=[],t=l;b(r,{enter(a,f){switch(a.type){case"Identifier":f&&m(a,f)&&n.push([t,a]);break;case"ImportDeclaration":a.specifiers.forEach(s=>{t.declarations.set(s.local.name,s)});break;case"FunctionExpression":case"FunctionDeclaration":case"ArrowFunctionExpression":a.type==="FunctionDeclaration"?(a.id&&t.declarations.set(a.id.name,a),e.set(a,t=new c(t,!1))):(e.set(a,t=new c(t,!1)),a.type==="FunctionExpression"&&a.id&&t.declarations.set(a.id.name,a)),a.params.forEach(s=>{o(s).forEach(u=>{t.declarations.set(u,a)})});break;case"ForStatement":case"ForInStatement":case"ForOfStatement":e.set(a,t=new c(t,!0));break;case"BlockStatement":e.set(a,t=new c(t,!0));break;case"ClassDeclaration":case"VariableDeclaration":t.add_declaration(a);break;case"CatchClause":e.set(a,t=new c(t,!0)),a.param&&o(a.param).forEach(s=>{a.param&&t.declarations.set(s,a.param)});break}},leave(a){e.has(a)&&t!==null&&t.parent&&(t=t.parent)}});for(let a=n.length-1;a>=0;--a){let[f,s]=n[a];f.references.has(s.name)||p(f,s.name),f.find_owner(s.name)||i.set(s.name,s)}return{map:e,scope:l,globals:i}}function p(r,e){r.references.add(e),r.parent&&p(r.parent,e)}var c=class{constructor(e,i){this.parent=e,this.block=i,this.declarations=new Map,this.initialised_declarations=new Set,this.references=new Set}add_declaration(e){if(e.type==="VariableDeclaration")if(e.kind==="var"&&this.block&&this.parent)this.parent.add_declaration(e);else{let i=l=>{o(l.id).forEach(n=>{this.declarations.set(n,e),l.init&&this.initialised_declarations.add(n)})};e.declarations.forEach(i)}else e.id&&this.declarations.set(e.id.name,e)}find_owner(e){return this.declarations.has(e)?this:this.parent&&this.parent.find_owner(e)}has(e){return this.declarations.has(e)||!!this.parent&&this.parent.has(e)}};function o(r){return h(r).map(e=>e.name)}function h(r,e=[]){switch(r.type){case"Identifier":e.push(r);break;case"MemberExpression":let i=r;for(;i.type==="MemberExpression";)i=i.object;e.push(i);break;case"ObjectPattern":let l=t=>{t.type==="RestElement"?h(t.argument,e):h(t.value,e)};r.properties.forEach(l);break;case"ArrayPattern":let n=t=>{t&&h(t,e)};r.elements.forEach(t=>{t&&n(t)});break;case"RestElement":h(r.argument,e);break;case"AssignmentPattern":h(r.left,e);break}return e}export{c as Scope,_ as analyze,h as extract_identifiers,o as extract_names};
//# sourceMappingURL=periscopic.mjs.map