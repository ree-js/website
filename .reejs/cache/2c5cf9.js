/* esm.sh - esbuild bundle(mdast-util-to-markdown@1.5.0/lib/util/safe) node production */
import{patternCompile as m}from"./004f6c.js";import{patternInScope as w}from"./03f11e.js";function C(i,a,r){let s=(r.before||"")+(a||"")+(r.after||""),n=[],c=[],t={},o=-1;for(;++o<i.unsafe.length;){let e=i.unsafe[o];if(!w(i.stack,e))continue;let x=m(e),p;for(;p=x.exec(s);){let u="before"in e||!!e.atBreak,b="after"in e,f=p.index+(u?p[1].length:0);n.includes(f)?(t[f].before&&!u&&(t[f].before=!1),t[f].after&&!b&&(t[f].after=!1)):(n.push(f),t[f]={before:u,after:b})}}n.sort(k);let l=r.before?r.before.length:0,h=s.length-(r.after?r.after.length:0);for(o=-1;++o<n.length;){let e=n[o];e<l||e>=h||e+1<h&&n[o+1]===e+1&&t[e].after&&!t[e+1].before&&!t[e+1].after||n[o-1]===e-1&&t[e].before&&!t[e-1].before&&!t[e-1].after||(l!==e&&c.push(d(s.slice(l,e),"\\")),l=e,/[!-/:-@[-`{-~]/.test(s.charAt(e))&&(!r.encode||!r.encode.includes(s.charAt(e)))?c.push("\\"):(c.push("&#x"+s.charCodeAt(e).toString(16).toUpperCase()+";"),l++))}return c.push(d(s.slice(l,h),r.after)),c.join("")}function k(i,a){return i-a}function d(i,a){let r=/\\(?=[!-/:-@[-`{-~])/g,s=[],n=[],c=i+a,t=-1,o=0,l;for(;l=r.exec(c);)s.push(l.index);for(;++t<s.length;)o!==s[t]&&n.push(i.slice(o,s[t])),n.push("\\"),o=s[t];return n.push(i.slice(o)),n.join("")}export{C as safe};
//# sourceMappingURL=safe.js.map