/* esm.sh - esbuild bundle(micromark-util-events-to-acorn@1.2.3) node production */
import{visit as T}from"./52f44b.js";import{VFileMessage as V}from"./e20bba.js";function U(i,o){let n=o.prefix||"",a=o.suffix||"",r=Object.assign({},o.acornOptions),s=[],p=[],m=r.onComment,x=r.onToken,w=!1,c,y,E=Object.assign({},r,{onComment:s,preserveParens:!0});x&&(E.onToken=p);let v=P(i,["lineEnding","expressionChunk","mdxFlowExpressionChunk","mdxTextExpressionChunk","mdxJsxTextTagExpressionAttributeValue","mdxJsxTextTagAttributeValueExpressionValue","mdxJsxFlowTagExpressionAttributeValue","mdxJsxFlowTagAttributeValueExpressionValue","mdxjsEsmData"]),f=v.value,h=n+f+a,b=o.expression&&C(f);if(b&&!o.allowEmpty)throw new V("Unexpected empty expression",u(0),"micromark-extension-mdx-expression:unexpected-empty-expression");try{c=o.expression&&!b?o.acorn.parseExpressionAt(h,0,E):o.acorn.parse(h,E)}catch(e){let t=e,l=u(t.pos);t.message=String(t.message).replace(/ \(\d+:\d+\)$/,""),t.pos=l.offset,t.loc={line:l.line,column:l.column-1},y=t,w=t.raisedAt>=n.length+f.length||t.message==="Unterminated comment"}if(c&&o.expression&&!b)if(C(h.slice(c.end,h.length-a.length)))c={type:"Program",start:0,end:n.length+f.length,body:[{type:"ExpressionStatement",expression:c,start:0,end:n.length+f.length}],sourceType:"module",comments:[]};else{let e=u(c.end),t=new Error("Unexpected content after expression");t.pos=e.offset,t.loc={line:e.line,column:e.column-1},y=t,c=void 0}if(c){if(c.comments=s,T(c,(e,t,l,k)=>{let g=k[k.length-1],d=t;e.type==="ParenthesizedExpression"&&g&&d&&(typeof l=="number"&&(g=g[d],d=l),g[d]=e.expression),A(e)}),Array.isArray(m))m.push(...s);else if(typeof m=="function")for(let e of s)m(e.type==="Block",e.value,e.start,e.end,e.loc.start,e.loc.end);for(let e of p)e.end<=n.length||e.start-n.length>=f.length||(A(e),Array.isArray(x)?x.push(e):x(e))}return{estree:c,error:y,swallow:w};function A(e){let t=u(e.start),l=u(e.end);e.start=t.offset,e.end=l.offset,e.loc={start:{line:t.line,column:t.column-1,offset:t.offset},end:{line:l.line,column:l.column-1,offset:l.offset}},e.range=[e.start,e.end]}function u(e){let t=e-n.length;t<0?t=0:t>f.length&&(t=f.length);let l=S(v.stops,t);return l||(l={line:o.start.line,column:o.start.column,offset:o.start.offset}),l}}function C(i){return/^\s*$/.test(i.replace(/\/\*[\s\S]*?\*\//g,"").replace(/\/\/[^\r\n]*(\r\n|\n|\r)/g,""))}function P(i,o){let n={value:"",stops:[]},a=-1;for(;++a<i.length;){let r=i[a];if(r[0]==="enter"&&o.includes(r[1].type)){let s=r[2].sliceStream(r[1]);for(;s.length>0&&s[0]===-1;)s.shift();let p=j(s);n.stops.push([n.value.length,r[1].start]),n.value+=p,n.stops.push([n.value.length,r[1].end])}}return n}function S(i,o){let n=0;for(;n<i.length&&i[n][0]<=o;)n+=1;if(n===0)return;let[a,r]=i[n-1],s=o-a;return{line:r.line,column:r.column+s,offset:r.offset+s}}function j(i){let o=-1,n=[],a;for(;++o<i.length;){let r=i[o],s;if(typeof r=="string")s=r;else switch(r){case-5:{s="\r";break}case-4:{s=`
`;break}case-3:{s=`\r
`;break}case-2:{s="	";break}case-1:{if(a)continue;s=" ";break}default:s=String.fromCharCode(r)}a=r===-2,n.push(s)}return n.join("")}export{U as eventsToAcorn};
//# sourceMappingURL=micromark-util-events-to-acorn.mjs.map